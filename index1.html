<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documento2</title>
    <link rel="stylesheet" href="amoreco1.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="index2.html">voltar</a></li>
        </ul>
    </nav>
    <h3>Lista de Alunos</h3>
<!-- cria uma tabela -->
<table id="tabelaAlunos" border="1">
    <!-- cabeçalho da tabela -->
    <thead>
        <!-- linha da tabela -->
        <tr>
            <!-- coluna da tabela -->
            <th>Nome</th>
            <th>Nascimento</th>
            <th>Telefone</th>
            <th>Endereço</th>
            <th>Excluir</th>
            <th>Atualizar</th>
        </tr>
    </thead>
    <!-- corpo da tabela -->
    <tbody>
        <!-- Linhas preenchidas pelo JavaScript -->
    </tbody>
</table>
<hr>


<script>
    var token = "d0628475394041d7b9f82c7a46c5a266";
         // Exemplo de requisição GET para listar pessoas
        fetch("https://crudcrud.com/api/"+token+"/pessoas")
        .then(response => response.json())
        .then(data => botaTabela(data) )
        .catch(error => console.error("Erro no GET:", error));


        // criamos a função botaTabela que recebe os DADOS da API de parametro
        function botaTabela(pessoas) {
            console.log(pessoas);
            // cria a variavel tabela que pega o corpo da tabela pelo ID
            // pega a tag Tbody dentro da tabela 
            // [0] pq getElementsByTagName retorna um array e queremos o primeiro elemento deste array
            var tabela = document.getElementById("tabelaAlunos").getElementsByTagName("tbody")[0];
            // inserir os Dados na tabela a partir da variavel do parametro pessoas
            // foreach (enquanto)
            pessoas.forEach(function(elemento) {
                    //  CRIANDO UMA LINHA USANDO UMA FUNÇÃO DO JAVASCRIPT
                    var linha = tabela.insertRow();
                    // criando a celula 0 da linha trabalhada
                    var celulaNome = linha.insertCell(0);
                    var celulaNascimento = linha.insertCell(1);
                    var celulaTelefone = linha.insertCell(2);
                    var celulaEndereco = linha.insertCell(3);
                    var celulaExcluir = linha.insertCell(4);
                    var celulaAtualizar = linha.insertCell(5);
                    // colocando os valores nas celulas criadas
                    celulaNome.innerHTML = elemento.nome;
                    celulaNascimento.innerHTML = elemento.nascimento;
                    celulaTelefone.innerHTML = elemento.telefone;
                    celulaEndereco.innerHTML = elemento.endereco;
                    celulaExcluir.innerHTML = '<button onclick="excluir(\'' + elemento._id + '\')">Excluir</button>';
                    celulaAtualizar.innerHTML =   '<button onclick="atualizar(\'' + elemento._id + '\',\''+elemento.nome+'\',\''+elemento.telefone+'\',\''+elemento.endereco+'\',\''+elemento.nascimento+'\')">Atualizar</button>';
            })
        }

        function excluir(id) {
            var token = "d0628475394041d7b9f82c7a46c5a266";
            // Exemplo de requisição DELETE para excluir uma pessoa
            fetch("https://crudcrud.com/api/"+token+"/pessoas/" + id, {
                method: "DELETE"
            })
            .finally(() => {
                // redirecionar para a pagina inicial
                setTimeout(window.location.href = "index2.html", 2000);
                
            });
        }
        function atualizar(id,nome,tel,end,data){
            window.location.href = "atualizarPessoa.html?id="+id+"&nome="+nome+"&tel="+tel+"&end="+end+"&data="+data
        }


</script>
</body>
</html>